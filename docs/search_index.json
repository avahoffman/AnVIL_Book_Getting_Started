[["index.html", "Getting Started on AnVIL About this Book", " Getting Started on AnVIL Katherine Cox 2021-05-18 About this Book This book holds a collection of guides to help new AnVIL users set up their accounts and start doing research on the AnVIL platform. "],["introduction.html", "Chapter 1 Introduction 1.1 Motivation", " Chapter 1 Introduction 1.1 Motivation This course will cover Target Audience: The course is intended for Curriculum: The curriculum will cover "],["pis-and-lab-managers.html", "Chapter 2 PIs and Lab Managers 2.1 Introduction 2.2 Account Setup 2.3 Budget Templates", " Chapter 2 PIs and Lab Managers 2.1 Introduction 2.1.1 Who is this guide for? 2.1.2 What’s in this guide? 2.1.3 Philosophy 2.2 Account Setup 2.2.1 Overview This guide provides an opinionated walkthrough on how to set up AnVIL for your lab, based on experiences from many labs actively using AnVIL. Following our recommendations will help you configure your team so that you can more clearly see where charges are coming from and have greater control over which users can spend your money and access your data. 2.2.1.1 Goals for this guide 2.2.1.2 Overview of Account Setup AnVIL uses Terra to run analyses. Terra operates on Google Cloud Platform, so you’ll pay for all storage and analysis costs through a Google account linked to Terra. The costs are the standard Google Cloud Platform fees for storing and moving data as well as executing an analysis. These costs are passed along through Terra without any markup. Create a Google account Set up Google Billing (and claim your free credits!). Add an administrator or viewer (optional) Link Terra to the Google Billing Account Create Terra Billing Projects Set budgets and alerts (optional, but highly recommended) Add users and Workspaces 2.2.1.3 Lab Management Roles While there are many ways to configure your lab, this guide defines the following roles and responsibilities: PI - The PI sets up the lab’s Google Cloud Account, creates its Google Billing Account(s), and Google Payment Method(s), links Terra with GCP, and invites Lab Managers to be Google Cloud “Billing Account Users.” Lab Manager (Optional) - A Lab Manager creates or clones Terra Workspaces and manages who can use those Workspaces. The Lab Manager is also responsible for creating one or more Terra Billing Projects configuring GCP budgets and alerts. Importantly, lab managers control who can spend lab money and should have an understanding of Google Cloud Billing and Terra Billing Projects. Depending on your lab, the PI may choose to be the only Lab Manager, or may appoint trusted lab members to assist. Data Analyst - A lab member who is granted write + can-compute access on one or more Terra Workspaces by a Lab Manager and who will run analyses in Terra. Data Analysts cannot share Terra Workspaces (this prevents them from enabling others to spend lab money). 2.2.1.4 Before you start You will need a credit card or bank account to activate your free trial and get started. Don’t worry! You won’t be billed until you explicitly turn on automatic billing, but payment information is needed for verification purposes. Before setting up billing yourself, you may want to check with your institutional procurement office and see if they have a preferred account set-up method with Google (such as a third party reseller or an existing account). To add lab members, you will need to know the Google account they will use to access Terra. You can complete most setup steps without this information and then add them once you know the correct accounts. 2.2.2 Step 1: Create a Google Account Terra operates on Google Cloud Platform, so you will need a (free) Google account which will allow you to Access the Terra platform to manage team members, data, and analyses Access Google Cloud Platform to manage billing Receive alerts when spending reaches specified thresholds If you do not already have a Google account that you would like to use for accessing Terra, create one now. If you would like to create a Google account that is associated with your non-Gmail, institutional email address, follow these instructions. 2.2.3 Step 2: Set up Google Billing Terra operates on Google Cloud Platform, and does not charge any markup. Rather than paying Terra or AnVIL, users set up billing directly with Google Cloud Platform. Make sure to use the same Google account ID you use to log into Terra for Google Cloud Billing. To set up billing, you must first create a Google “Billing Account”. You can create multiple Billing Accounts associated with your Google ID. We recommend creating separate Billing Accounts for different funding sources. 2.2.3.1 Create a Google Billing Account Log in to the Google Cloud Platform console using your Google ID. Make sure to use the same Google account ID you use to log into Terra. If you are a first time user, don’t forget to claim your free credits! If you haven’t been to the console before, once you accept the Terms of Service you will be greeted with an invitation to “Try for Free.” Follow the instructions to sign up for a Billing Account and get your credits. Choose “Individual Account”. This “billing account” is just for managing billing, so you don’t need to be able to add your lab members. You will need to give either a credit card or bank account for security. Don’t worry! You won’t be billed until you explicitly turn on automatic billing. You can view and edit your new Billing Account, by selecting “Billing” from the left-hand menu, or going direction to the billing console console.cloud.google.com/billing Clicking on the Billing Account name will allow you to manage the account, including accessing reports, setting alerts, and managing payments and billing. We will cover account management in greater detail below. At any point, you can create additional Billing Accounts using the Create Account button. We recommend creating a new Billing Account for each funding source. 2.2.3.2 Add users or viewers (optional) If you have a project manager or finance administrator who needs access to a Billing Account, you can add them with a few different levels of permissions. Generally the most useful are: Users have a great deal of power over spending - they can create new “Billing Projects” and control who can spend money on those projects. If you have a lab or accounts manager responsible for expenses, it may make sense to add them as a Billing Account User. If you wish to retain full control over who can spend money on GCP, you should not add any Users. Viewers can see the activity in the Billing Account but can’t make any changes. This can be useful for finance staff who need access to the reports, or for lab members to be able to see what their analyses are costing. Anyone you wish to add to the Billing Account will need their own Google ID. To add a member to a Billing Project: Log in to the Google Cloud Platform console using your Google ID. Navigate to Billing You may be automatically directed to view a specific Billing Account. If you see information about a single account rather than a list of your Billing Accounts, you can get back to the list by clicking “Manage Billing Accounts” from the drop-down menu. Check the box next to the Billing Account you wish to add a member to, click “ADD MEMBER”. Enter their Google ID in the text box. In the drop-down menu, mouse over Billing, then choose the appropriate role. Click “SAVE”. 2.2.4 Step 3: Add Terra to the Google Billing Account This gives Terra permission to create projects and send charges to the Google Billing Account, and must be done by an administrator of the Google Billing Account. Terra needs to be added as a “Billing Account User”: Log in to the Google Cloud Platform console using your Google ID. Navigate to Billing You may be automatically directed to view a specific Billing Account. If you see information about a single account rather than a list of your Billing Accounts, you can get back to the list by clicking “Manage Billing Accounts” from the drop-down menu. Check the box next to the Billing Account you wish to add Terra to, click “ADD MEMBER”. Enter terra-billing@terra.bio in the text box. In the drop-down menu, mouse over Billing, then choose “Billing Account User”. Click “SAVE”. 2.2.5 Step 4: Create Terra Billing Projects This is how you enable Terra users to charge to the Google Billing Account. Note that Google will report charges at the level of Billing Projects. If you create only one Billing Project for your lab, you will not be able to see a breakdown of where charges are coming from. It is highly recommended that you create separate Billing Projects for each category of spending you would like to track. For example: A Billing Project for each lab member, if you would like to track individual spending A Billing Project for each analysis type, if you would like to track spending on e.g. RNA-seq vs. variant calling. A Billing Project for each cohort, if you would like to track spending per data set If you are uncertain, we recommend starting by setting up a Billing Project per lab member. This makes it easy to track lab member spending, and also makes it easier to cleanly shut down projects when a member leaves the lab. 2.2.5.1 Create a Billing Project Launch Terra and sign in with your Google account. Make sure to use the same Google account that you used to set up Google Billing. If this is your first time logging in to Terra, you will need to accept the Terms of Service. In the drop-down menu on the left, navigate to “Billing”. Click the triple bar in the top left corner to access the menu. Click the arrow next to your name to expand the menu. Click Billing. On the Billing page, click the plus icon to create a new Billing Project. If prompted, select the Google account to use. Make sure to use the same Google account that you used to set up Google Billing. If prompted, give Terra permission to manage Google Cloud Platform billing accounts. Enter a unique name for your Terra Billing Project and select the appropriate Google Billing Account. The name of the Terra Billing Project must: Only contain lowercase letters, numbers and hyphens Start with a lowercase letter Not end with a hyphen Be between 6 and 30 characters Be unique across all Google Billing Projects As mentioned above, we recommend creating separate Terra Billing Projects for each of your team members so you can track their spending. These Billing Projects can all be associated with the same Google Billing Account if they are all funded by the same source. 2.2.6 Step 5: Set Budgets and Alerts Cloud computing can save a great deal of money, time and effort by providing compute on an as-needed basis. However, care must be taken that users do not accidentally request excessive resources, or leave resources running when not needed. Unfortunately, there are two issues that make direct cost control difficult: The Google Cloud billing interface does not provide a way to automatically cancel computations when a spending threshold is reached Compute costs are reported with a delay (~1 day) As a PI or lab manager, there are some steps you can take to help monitor and limit spending: Be careful with members and permissions in your Billing Projects and Workspaces on Terra (see Adding Users and Workspaces for recommended setup) Most importantly, monitor your spending so you can shut down unnecessary expensive activities before they have time to accumulate. Terra provides extensive documentation and examples regarding cost management while working in the cloud We highly recommended you set budgets and alerts to notify you if spending starts to exceed expectations. This will make it easier to notice and shut down any accidental overspending. A good starting point is to set a monthly budget, and then set alerts at 50 percent and 90 percent of expected spend. You can add additional alerts if you desire. You can set a single Budget for your entire lab, set up individual budgets for each Billing Project, or even set budgets for certain subsets of your Billing Projects. This will depend on the size of your lab and how closely you want to monitor spending. More granular budgets make it quicker to notice and track down overspending from a particular project but mean you will get more emails every month. When setting budgets with broader scope, you can always find out which particular Billing Project is spending the money by checking in the GCP Billing interface. NOTE: that there may be some restrictions on the budgets and alerts you can set while you’re using GCP’s free credits. At the time of writing (Feb 2021) you are not able to set budgets for individual projects while you are using the GCP free credits, but can still set an overall budget. Any restrictions should be lifted when you upgrade to a paid account. 2.2.6.1 Set alerts Log in to the Google Cloud Platform console using your Google ID. Navigate to Billing You may be automatically directed to view a specific Billing Account. If you see information about a single account (other than the one you’re interested in), you can get back to the list of all your Billing Accounts by clicking “Manage Billing Accounts” from the drop-down menu. Click on the name of the Billing Account you want to set alerts for. In the left-hand menu, click “Budgets &amp; alerts”. Click “Create Budget”. Enter a name for your budget, and then choose what you want to monitor. Click “Next”. For Budget Type, select “Specified amount”. Enter the total budget amount for the month (you will set alerts at different thresholds in the next step). Click “Next” (not “Finish”). Enter the threshold amounts where you want to receive an alert. We recommend starting with 50% and 90%. You can set other alerts if you prefer. Check the box for “Email alerts to billing admins and users”. Click “Finish”. Now you (as the owner and admin), along with anyone you added with admin or user privileges (e.g lab managers) will receive alerts when your lab members reach the specified spending thresholds. These emails will be sent to the Gmail accounts associated with the Billing Account. You can edit your budgets at any time by going to Billing &gt; Budgets &amp; alerts, and clicking on the name of the budget you want to edit. 2.2.7 Step 6: Add Users and Workspaces 2.3 Budget Templates If you want to apply for a grant and you plan to use the AnVIL platform for data storage, data movement, and data analysis, you can include the anticipated costs in your proposal. We have created a template for the budget justification paragraph of your grant proposal. The documents described in the following provide you with insightful knowledge. 2.3.1 Types of Costs There are three types of costs that are typically occur when performing operations on the Google Cloud Platform. 1. Cost for Computing is driven by your particular CPU and memory requirements. Importantly, you can save money if your work can tolerate being interrupted (also known as a preemptible compute resource). In this case, you pay less per hour with the understanding that your work may be interrupted by a customer willing to pay more. Details and current pricing can be found here. 2. Cost for Storage is driven by the amount of data and the length of time you wish to store the data. Here, you can save money if you have data that you do not plan to access frequently. This would be the case for raw data that has already been processed, backups, and archives. Details and current pricing can be found here. 3. Cost for Network Usage (egress) applies to data being transferred out of a Cloud resource. In this context, a Cloud resource refers to a set of computers in a particular region. This would apply, for example, if you transferred data from Google’s East Coast computers to Amazon’s West Coast computers. In general, while it’s free to upload data to the Cloud, you will incur costs when downloading data to your local computer or between Cloud regions. Details and current pricing can be found here. 2.3.2 Usage of Budget Templates In a first step, you can use the template Google Sheet AnVIL_Cost_Estimator to calculate costs for computing, storage, and network usage (egress) for your proposal. In a second step, you can use the template Google Doc AnVIL_Budget_Justification to create a budget justification paragraph for your proposal by including the information highlighted in pink (mostly copying entries from your Google Sheet AnVIL_Cost_Estimator). Please download and adapt both documents to your project. Please check that the prices are up to date by using the links listed below or in the AnVIL_Cost_Estimator. For further guidance, you can have a look at a completed document AnVIL_Budget_Justification_Example. "],["data-analysts.html", "Chapter 3 Data Analysts 3.1 Introduction", " Chapter 3 Data Analysts 3.1 Introduction 3.1.1 Who is this guide for? 3.1.2 What’s in this guide? "],["instructors.html", "Chapter 4 Instructors 4.1 Introduction", " Chapter 4 Instructors 4.1 Introduction 4.1.1 Who is this guide for? 4.1.2 What’s in this guide? "],["tools.html", "Chapter 5 Tools 5.1 Introduction", " Chapter 5 Tools 5.1 Introduction 5.1.1 Who is this guide for? 5.1.2 What’s in this guide? "],["data.html", "Chapter 6 Data 6.1 Introduction", " Chapter 6 Data 6.1 Introduction 6.1.1 Who is this guide for? 6.1.2 What’s in this guide? "],["workflows.html", "Chapter 7 Workflows 7.1 Introduction", " Chapter 7 Workflows 7.1 Introduction 7.1.1 Who is this guide for? 7.1.2 What’s in this guide? "],["security.html", "A Security A.1 Introduction", " A Security A.1 Introduction A.1.1 Who is this guide for? A.1.2 What’s in this guide? "],["billing.html", "B Billing B.1 Introduction", " B Billing B.1 Introduction B.1.1 Who is this guide for? B.1.2 What’s in this guide? "],["about-the-authors.html", "About the Authors", " About the Authors Author Name is a Blank in the Blank at the Blank. "]]
